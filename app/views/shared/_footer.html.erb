<%# Минималистичный футер с редактируемым текстом и колонками меню %>
<% app_name = (defined?(Rails.application.config.app_name) && Rails.application.config.app_name.presence) || "MindReport" %>
<% footer_text = SiteSetting.fetch("footer_text", "#{app_name} — редактируемый текст футера (Админка → Settings)") %>

<%# Кэшируем по датам обновления сущностей %>
<% cache(["footer",
          SiteSetting.maximum(:updated_at),
          FooterSection.maximum(:updated_at),
          FooterLink.maximum(:updated_at)]) do %>

  <footer class="mt-16 border-t border-gray-200 bg-white/50 supports-[backdrop-filter]:bg-white/60 backdrop-blur">
    <div class="container mx-auto px-4 py-10">
      <div class="grid grid-cols-1 md:grid-cols-4 gap-8">
        <!-- Левая — базовый текст -->
        <div class="md:col-span-1">
          <div class="text-sm text-gray-600 leading-6">
            <%= sanitize(simple_format(footer_text)) %>
          </div>
        </div>

        <!-- Правые колонки — секции меню -->
        <% sections = FooterSection.published.includes(:footer_links).limit(3) %>
        <% (0..2).each do |i| %>
          <div>
            <% if sections[i].present? %>
              <h4 class="text-sm font-semibold text-gray-900 mb-3"><%= sections[i].title %></h4>
              <ul class="space-y-2">
                <% sections[i].footer_links.each do |link| %>
                  <li>
                    <%= link_to link.label,
                                link.url,
                                class: "text-sm text-gray-600 hover:text-gray-900 transition-colors",
                                target: (link.target_blank? ? "_blank" : nil),
                                rel: (link.target_blank? ? "noopener" : nil) %>
                  </li>
                <% end %>
              </ul>
            <% else %>
              <%# Плейсхолдер-пустышка (ничего не рисуем, чтобы остался ритм сетки) %>
              <div class="text-sm text-gray-400"></div>
            <% end %>
          </div>
        <% end %>
      </div>

      <div class="mt-10 pt-6 border-t border-gray-200 flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4">
        <p class="text-xs text-gray-500">© <%= Time.current.year %> <%= app_name %>. Все права защищены.</p>
        <div class="text-xs text-gray-400">
          <%= link_to "Политика", "#", class: "hover:text-gray-700 transition-colors" %>
          <span class="mx-2">•</span>
          <%= link_to "Условия", "#", class: "hover:text-gray-700 transition-colors" %>
        </div>
      </div>
    </div>
  </footer>
<% end %>
