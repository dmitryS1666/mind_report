<div class="mx-auto max-w-6xl">
  <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ + –º–æ–¥–∞–ª–∫–∞ –∂–∏–≤—É—Ç –≤ –æ–¥–Ω–æ–º –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–µ -->
  <div class="mb-4 flex items-center justify-between">
    <div>
      <h1 class="text-2xl font-semibold text-slate-900">–ù–æ–≤—ã–π –∞–Ω–∞–ª–∏–∑</h1>
      <p class="text-slate-600 text-sm">–ó–∞–≥—Ä—É–∑–∏—Ç–µ –∞—É–¥–∏–æ –∏ –∑–∞–ø—É—Å—Ç–∏—Ç–µ –¥–µ–º–æ-–∞–Ω–∞–ª–∏–∑.</p>
    </div>

    <!-- —Å–ø—Ä–∞–≤–∞ -->
    <button type="button"
            class="inline-flex items-center gap-2 px-3 py-2 text-sm rounded-lg border border-slate-300 hover:bg-slate-50"
            data-action="click->modal#open">
      üìú –ò—Å—Ç–æ—Ä–∏—è
    </button>
  </div>

  <div class="grid grid-cols-12 gap-4">
    <!-- –ü–†–ê–í–ê–Ø –ü–ê–ù–ï–õ–¨: ¬´–ß–∞—Ç¬ª -->
    <section class="col-span-12">
      <div id="chat"
           class="bg-white border border-slate-200 rounded-xl p-4 space-y-4
                  max-h-[calc(100vh-220px)] overflow-y-auto">

        <!-- —Ç—É–ª–±–∞—Ä -->
        <div class="flex items-center justify-between">
          <div class="text-sm text-slate-600">–õ–µ–Ω—Ç–∞ —Å–æ–±—ã—Ç–∏–π</div>
          <div class="flex items-center gap-2">
            <!-- –û—á–∏—Å—Ç–∏—Ç—å –ª–µ–Ω—Ç—É (UI) -->
            <button type="button"
                    class="text-xs px-2 py-1 rounded-md border border-slate-300 hover:bg-slate-50"
                    onclick="(function(){const a=document.getElementById('analysis_panels');const s=document.getElementById('analysis_stream_target');if(a)a.innerHTML='';if(s)s.innerHTML='';})()">
              –û—á–∏—Å—Ç–∏—Ç—å –ª–µ–Ω—Ç—É
            </button>

            <!-- –û—á–∏—Å—Ç–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é (–ë–î) -->
            <%= button_to "–û—á–∏—Å—Ç–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é",
                  clear_history_analyses_path,
                  method: :delete,
                  form: { data: { turbo_stream: true } },
                  class: "text-xs px-2 py-1 rounded-md border border-rose-300 text-rose-700 hover:bg-rose-50" %>
          </div>
        </div>

        <!-- –ø–∞–Ω–µ–ª–∏ —Ç–µ–∫—É—â–µ–≥–æ –∞–Ω–∞–ª–∏–∑–∞ -->
        <div id="analysis_panels"></div>

        <!-- –æ–±—â–∏–π —Å—Ç—Ä–∏–º –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ -->
        <%= turbo_stream_from "analyses_stream_user_#{current_user.id}" %>
        <div id="analysis_stream_target" class="space-y-3"></div>

        <!-- –ù–µ–¥–∞–≤–Ω–∏–µ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) -->
        <% if @recent_analyses.present? %>
          <div class="pt-2 border-t border-slate-100">
            <h3 class="text-sm font-semibold text-slate-700 mb-2">–ù–µ–¥–∞–≤–Ω–∏–µ</h3>
            <ul class="space-y-2 text-sm">
              <% @recent_analyses.each do |a| %>
                <li>
                  <%= link_to "–ê–Ω–∞–ª–∏–∑ ##{a.id} ‚Äî #{a.status}", analysis_path(a),
                              class: "text-slate-900 hover:underline" %>
                  <div class="text-slate-500"><%= l(a.created_at, format: :short) %></div>
                </li>
              <% end %>
            </ul>
          </div>
        <% end %>
      </div>

      <!-- –õ–∏–ø–∫–∞—è —Ñ–æ—Ä–º–∞ -->
      <div class="sticky bottom-4 mt-4">
        <div class="bg-white border border-slate-200 rounded-xl p-3 shadow-sm">
          <%= form_with url: demo_analyses_path,
                        method: :post,
                        data: { turbo_stream: true },
                        html: { class: "flex items-center gap-3", enctype: "multipart/form-data" } do |f| %>

            <%= f.file_field :audio, required: true, accept: "audio/*",
                  class: "block w-full text-sm text-slate-600
                          file:mr-3 file:py-2 file:px-3 file:rounded-lg file:border-0
                          file:text-sm file:font-semibold
                          file:bg-slate-900 file:text-white
                          hover:file:bg-slate-800" %>

            <span class="hidden md:block text-xs text-slate-500 whitespace-nowrap">
              –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è mp3, m4a, wav –∏ –¥—Ä.
            </span>

            <%= f.submit "–ó–∞–ø—É—Å—Ç–∏—Ç—å –¥–µ–º–æ-–∞–Ω–∞–ª–∏–∑",
                  class: "px-4 py-2 rounded-lg bg-emerald-600 text-white text-sm font-semibold hover:bg-emerald-700" %>
          <% end %>
        </div>
      </div>
    </section>
  </div>
</div>
