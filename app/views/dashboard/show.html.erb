<div class="grid md:grid-cols-3 gap-6">
  <!-- Левая колонка: форма -->
  <div class="md:col-span-1">
    <div class="bg-white border border-gray-200 rounded-xl shadow-sm p-6">
      <h2 class="text-lg font-semibold mb-4">Новый анализ</h2>

      <%= form_with url: demo_analyses_path, method: :post, data: { turbo_stream: true }, html: { class: "space-y-4", enctype: "multipart/form-data" } do |f| %>
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">Аудиофайл</label>
          <input type="file" name="analysis[audio]"
                 accept="audio/*"
                 class="w-full rounded-lg border border-gray-300 px-3 py-2 text-sm shadow-sm focus:border-gray-500 focus:ring-2 focus:ring-gray-200">
          <p class="text-xs text-gray-500 mt-1">Поддерживаются форматы mp3, m4a, wav и др.</p>
        </div>

        <button class="w-full bg-gray-900 text-white rounded-lg px-4 py-2 font-medium hover:bg-gray-800 transition">
          Запустить демо-анализ
        </button>
      <% end %>
    </div>

    <div class="bg-white border border-gray-200 rounded-xl shadow-sm p-6 mt-6">
      <h3 class="text-sm font-semibold text-gray-700 mb-2">Недавние</h3>
      <ul class="space-y-2 text-sm">
        <% @recent_analyses.each do |a| %>
          <li>
            <%= link_to "Анализ ##{a.id} — #{a.status}", analysis_path(a), class: "text-gray-900 hover:underline" %>
            <div class="text-gray-500"><%= l(a.created_at, format: :short) %></div>
          </li>
        <% end %>
      </ul>
    </div>
  </div>

  <!-- Правая колонка: «чат-панель» текущего анализа -->
  <div class="md:col-span-2">
    <div id="analysis_panels">
      <%# Когда создаём новый анализ, сервер вернёт turbo_stream и вставит панель %}
    </div>

    <%# Общий стрим контейнер для сообщений прогресса %>
    <%= turbo_stream_from "analyses_stream_user_#{current_user.id}" %>
    <div id="analysis_stream_target" class="mt-4 space-y-3"></div>
  </div>
</div>
